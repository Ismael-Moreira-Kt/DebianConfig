#!/bin/bash



function configure_package_management_en() {
    local CHOICE=-1

    while true; do
        clear

        echo "Choose an option to configure package management:"
        echo "1. Configure APT Preferences"
        echo "2. Set Up Aptitude"
        echo "3. Configure Package Caching"
        echo "4. Configure Automatic Upgrades"
        echo "5. Install Package Management Tools"
        echo "6. Show Package Management Configuration"
        echo "7. Return to Main Menu"

        read -p "Your choice (1-7): " CHOICE

        case $CHOICE in
            1) configure_apt_preferences ;;
            2) set_up_aptitude ;;
            3) configure_package_caching ;;
            4) configure_automatic_upgrades ;;
            5) install_package_management_tools ;;
            6) show_package_management_configuration ;;
            7) break ;;
            *) echo "Invalid option. Please try again." ;;
        esac
    done
}



function configure_apt_preferences() {
    echo "Configuring APT preferences..."

    sudo mkdir -p /etc/apt/preferences.d

    echo "Package: *" | sudo tee /etc/apt/preferences.d/custom.pref > /dev/null
    echo "Pin: release a=stable" | sudo tee -a /etc/apt/preferences.d/custom.pref > /dev/null
    echo "Pin-Priority: 500" | sudo tee -a /etc/apt/preferences.d/custom.pref > /dev/null
    echo "APT preferences configured."
}



function set_up_aptitude() {
    echo "Setting up Aptitude..."


    sudo apt install -y aptitude

    echo "Aptitude installed and configured."
}



function configure_package_caching() {
    echo "Configuring package caching..."
    echo "Configuring APT cache directories..."
    
    sudo mkdir -p /var/cache/apt/archives/partial
    sudo chmod 755 /var/cache/apt/archives/partial

    echo "Setting up APT cache cleaning..."
    echo "APT::Clean-Installed \"true\";" | sudo tee /etc/apt/apt.conf.d/10clean > /dev/null
    echo "Package caching configured."
}



function configure_automatic_upgrades() {
    echo "Configuring automatic upgrades..."

    echo "Installing unattended-upgrades..."

    sudo apt install -y unattended-upgrades

    echo "Configuring unattended-upgrades..."

    sudo dpkg-reconfigure --priority=low unattended-upgrades

    echo "Automatic upgrades configured."
}



function install_package_management_tools() {
    echo "Installing package management tools..."

    sudo apt install -y apt-listchanges debconf-utils

    echo "Package management tools installed."
}



function show_package_management_configuration() {
    echo "Showing package management configuration..."

    echo "APT Preferences:"

    cat /etc/apt/preferences.d/custom.pref

    echo
    echo "APT Caching Configuration:"

    cat /etc/apt/apt.conf.d/10clean

    echo
    echo "Installed Package Management Tools:"

    dpkg -l | grep -E 'aptitude|apt-listchanges|debconf-utils'

    echo "Package management configuration displayed."

    while true; do
        read -rsn1 input
        
        if [[ $input == 'q' ]]; then
            break
        fi
    done
}